# 魔塔传说

## 项目简介

魔塔传说是一款基于Python和Pygame开发的经典魔塔类游戏复刻作品。游戏以经典的魔塔探索为核心玩法，玩家需要在100层精心设计的关卡中探索，击败各种怪物，收集道具和钥匙，不断提升自己的属性实力，最终到达塔顶完成挑战。游戏采用了现代化的界面设计和流畅的动画效果，同时支持手动操作和AI自动战斗两种模式，为玩家提供更加灵活的游戏体验。

本项目完全开源，开发者可以自由学习、修改和分发。游戏使用Windows系统中常见的中文字体，确保中文显示的准确性和美观性。打包后的程序可以在Windows 7/8/10/11等主流操作系统上流畅运行。

## 游戏功能

### 核心玩法

魔塔传说的核心玩法围绕探索、战斗和成长三个要素展开。玩家在每一层楼中都需要仔细规划移动路线，避开危险区域，寻找向上的楼梯。游戏中的每个楼层都经过精心设计，包含各种障碍物、隐藏房间和特殊事件。玩家需要合理分配资源，在提升战斗能力的同时保存足够的药品和钥匙应对突发状况。

游戏采用回合制战斗系统，玩家和怪物轮流行动。玩家需要根据怪物的属性特点选择合适的战斗策略，合理使用背包中的道具。战斗胜利后，玩家可以获得经验值和金币，经验值积累到一定程度后角色会自动升级，获得属性点的提升。

### 主要特性

本游戏具备以下主要特性，使其区别于传统的魔塔游戏：

**自动属性成长系统**：游戏采用了创新的自动升级机制，玩家在获得足够经验值后会自动升级，无需手动分配属性点。升级时会同时提升生命值上限、攻击力和防御力三项核心属性，让玩家可以专注于探索和战斗本身。

**AI自动战斗模式**：游戏内置了智能的AI系统，按下F键即可切换到自动战斗模式。在AI模式下，系统会自动控制角色移动、战斗和道具使用，非常适合想要快速通关或休闲游玩的玩家。AI系统具备寻路功能，能够自动规划最优路线避开障碍物。

**完整的商店系统**：游戏在特定楼层设有商店NPC，玩家可以使用金币购买各种道具，包括恢复生命值的红药水、不同颜色的钥匙以及永久提升属性的药剂。商店物价合理，玩家需要通过战斗获取足够的金币来购买所需物品。

**100层关卡设计**：游戏包含100层精心设计的关卡，每一层楼都有独特的地图布局和怪物配置。随着楼层的深入，怪物的强度会逐渐增加，对玩家的装备和属性要求也越来越高。

**存档和读档功能**：游戏支持自动存档功能，玩家在上下楼梯时会自动保存当前进度。如果游戏失败，可以随时从存档点重新开始，避免重复劳动。

### 游戏界面

游戏界面采用了现代化的设计风格，使用了丰富的主题色彩来区分不同的游戏元素。主界面以深色调为主，配合高亮的文字和图标，确保在各种环境下都能清晰辨识。游戏界面包含以下主要区域：

顶部区域显示当前楼层的名称和主要状态信息，包括当前生命值、攻击力、防御力等关键属性。中部区域是游戏的主地图，采用网格化的设计，每个格子代表一个地图单位。底部区域显示扩展的状态信息，包括金币数量、经验值、拥有的钥匙类型以及AI模式状态。

游戏还提供了多个子界面，包括主菜单界面、战斗界面、背包界面、商店界面和关于界面等。每个界面都经过精心设计，确保操作简便且视觉效果良好。

## 安装指南

### 方式一：使用安装包（推荐）

对于普通用户，我们强烈建议使用安装包进行安装，这样可以获得完整的安装体验和卸载功能。请按照以下步骤操作：

首先，从发布页面下载最新版本的安装包文件，文件名为「魔塔传说_1.0.0_setup.zip」。下载完成后，将安装包解压到任意临时目录。解压完成后，双击运行其中的「setup.bat」文件，系统可能会弹出用户账户控制对话框，请点击「是」允许程序运行。

安装程序启动后，会显示版本信息和发行商信息。接下来程序会检测系统版本，并自动选择合适的安装路径。如果是64位系统，默认安装路径为「C:\Program Files (x86)\魔塔传说」；如果是32位系统，默认安装路径为「C:\Program Files\魔塔传说」。用户也可以选择自定义安装路径。

安装程序提供三个选项：开始安装、自定义安装路径、取消安装。选择第一项将使用默认路径进行安装，选择第二项可以手动输入安装路径，选择第三项将退出安装程序。安装过程中，程序会自动复制所需文件、创建开始菜单快捷方式、创建桌面快捷方式并生成卸载程序。

安装完成后，程序会显示安装成功的消息，并询问是否立即启动游戏。用户可以选择立即体验游戏，或者关闭安装程序稍后自行启动。

### 方式二：直接运行打包程序

如果只需要运行游戏而无需安装完整的安装程序，可以使用已打包的exe文件。请找到之前使用PyInstaller打包生成的「魔塔传说.exe」文件，直接双击即可运行。这种方式不需要安装过程，但不会创建快捷方式，卸载时需要手动删除文件。

### 从源码运行

对于开发者或想要了解游戏实现细节的用户，可以从源码运行游戏。首先确保系统中已安装Python 3.8或更高版本，以及Pygame库。进入游戏源代码目录，直接运行「python main.py」命令即可启动游戏。这种方式需要保持源代码结构完整，不适合分发。

### 系统要求

运行本游戏需要满足以下最低系统要求：

- **操作系统**：Windows 7、Windows 8、Windows 10或Windows 11
- **处理器**：1GHz或更高频率的处理器
- **内存**：512MB RAM或更多
- **显卡**：支持DirectX 9.0c的显卡
- **存储空间**：100MB可用磁盘空间
- **其他**：支持DirectX的声卡（可选，用于音效）

推荐配置为2GHz以上处理器、2GB以上内存和支持DirectX 11的显卡，以获得最佳的游戏体验。

## 操作说明

### 基础操作

游戏支持键盘操作，以下是所有的基础操作说明：

移动操作可以使用方向键或WASD键。向上移动可以按↑键或W键，向下移动可以按↓键或S键，向左移动可以按←键或A键，向右移动可以按→键或D键。移动时会检查碰撞，墙壁和其他障碍物会阻挡移动。

打开背包可以按I键。背包界面会显示当前拥有的所有物品，包括红药水数量、各种钥匙数量等。在背包界面中按1键可以使用红药水恢复50点生命值，再次按I键可以关闭背包返回游戏。

切换AI模式可以按F键。在AI模式下，游戏会自动控制角色移动和战斗，玩家可以欣赏AI的表现或让它自动通关。AI模式可以在任何游戏状态下切换，非常方便。

### 战斗操作

游戏中的战斗采用回合制，进入战斗状态后会自动暂停其他操作。在战斗中按空格键可以进行当前回合的操作。玩家回合时，角色会自动对怪物发起攻击，造成伤害后切换到怪物回合。怪物回合时，怪物会对玩家发起攻击，玩家会扣除相应的生命值。如果怪物被击败，玩家会获得经验值和金币奖励。如果玩家被击败，游戏会进入结束状态。

### 商店操作

与NPC交互后会进入商店界面。在商店界面中按数字键1到7可以选择购买对应的商品，按ESC键可以离开商店返回游戏。购买商品时会自动扣除相应的金币，如果金币不足则无法购买。

### 菜单操作

在主菜单中按数字键1可以开始游戏，按数字键2可以查看关于信息，按数字键3可以退出游戏。在关于界面中按任意键可以返回主菜单。在游戏结束界面按R键可以从存档点重新开始游戏。

### 游戏状态

游戏包含以下几种状态：

- **主菜单**：游戏启动后的初始状态，显示标题和菜单选项
- **游戏中**：正常的探索和战斗状态
- **战斗**：与怪物交战的特殊状态
- **背包**：查看和使用物品的状态
- **商店**：购买道具的特殊状态
- **游戏结束**：玩家被击败后的状态
- **胜利**：完成游戏后的最终状态
- **关于**：显示游戏信息和介绍的状态

## 游戏系统

### 玩家属性

玩家角色具有以下核心属性：

**等级**：表示玩家的当前等级，初始为1级，最高可以达到100级。等级越高，基础属性越高。获得经验值可以提升经验条，经验条满后自动升级。

**生命值**：表示玩家的当前生命状态，初始为100点，最高可以超过100点。生命值归零时玩家被击败。战斗中被怪物攻击会扣除生命值，使用红药水可以恢复生命值。

**攻击力**：表示玩家的伤害输出能力，初始为10点。攻击力越高，对怪物造成的伤害越高。升级和购买攻击药剂可以永久提升攻击力。

**防御力**：表示玩家的伤害减免能力，初始为10点。防御力越高，怪物攻击时玩家受到的伤害越低。升级和购买防御药剂可以永久提升防御力。

**金币**：用于在商店购买道具的货币，通过战斗击败怪物获得。初始为0，金币不会因任何原因减少。

**经验值**：用于衡量玩家成长的数值，通过战斗击败怪物获得。经验值积累到一定程度后玩家会升级，获得属性提升。

### 物品系统

游戏中的物品分为以下几类：

**消耗品**包括红药水，可以恢复50点生命值。红药水是游戏中最重要的消耗品，玩家需要保持一定的储备以应对连续的战斗。红药水可以在地图上拾取，也可以在商店购买。

**钥匙**分为红钥匙、黄钥匙和蓝钥匙三种，分别用于打开对应颜色的门。钥匙是探索更高楼层必需的工具，某些关键路径被不同颜色的门阻挡，玩家需要找到对应颜色的钥匙才能通过。

**永久道具**包括攻击药水、防御药水和生命药水三种，分别永久提升攻击力5点、防御力5点和生命值上限20点。这些道具的效果是永久的，但价格较高，建议在有足够金币时购买。

### AI系统

游戏的AI系统具备以下能力：

**自动寻路**：AI能够使用广度优先搜索算法规划最优路径，避开墙壁和障碍物，以最短路径到达目标位置。

**智能决策**：AI能够根据当前状态做出合理决策。如果生命值低于30%，AI会优先寻找红药水。如果附近有怪物，AI会主动发起攻击。如果没有怪物且没有药水需求，AI会寻找楼梯上楼。

**自动战斗**：在战斗状态下，AI会自动进行回合操作。玩家按下空格键后，AI会执行当前回合的攻击或闪避操作。

AI系统的更新间隔默认为100毫秒，确保AI响应及时但不会过快。玩家可以随时按F键切换AI模式的开关状态。

### 存档系统

游戏采用自动存档机制，在以下情况下会自动保存进度：

**上楼梯时**：当玩家通过向上的楼梯离开当前楼层时，系统会自动保存当前进度。存档内容包括玩家的属性状态、背包物品和当前楼层。

**下楼梯时**：当玩家通过向下的楼梯离开当前楼层时，系统也会自动保存进度。这确保了玩家可以随时从任何楼层重新开始。

**开始游戏时**：每次启动游戏时，如果存在存档文件，游戏会询问是否从存档继续。如果选择是，玩家可以从上次离开的楼层继续冒险。

存档文件保存在游戏目录下，文件名为「save_game.dat」。如果需要重置游戏，可以删除此存档文件。

## 开发信息

### 项目结构

本项目采用模块化的设计，包含以下主要文件：

- **main.py**：游戏的主程序文件，包含Game类，负责游戏主循环、事件处理、渲染和状态管理
- **constants.py**：游戏常量定义，包括窗口设置、颜色定义、地图元素ID、游戏状态、商店物品配置等
- **player.py**：玩家角色类，包含玩家属性管理、移动逻辑、战斗方法等
- **monster.py**：怪物类，包含怪物属性、行为AI、奖励计算等
- **map.py**：地图类，负责地图数据管理、碰撞检测、物品和怪物管理等
- **魔塔传说_logo.png**：游戏图标文件

### 技术栈

游戏使用以下技术构建：

- **编程语言**：Python 3.8+
- **图形库**：Pygame 2.6.1
- **打包工具**：PyInstaller 6.17.0
- **安装包生成**：自定义Python脚本
- **支持平台**：Windows 7/8/10/11

### 字体处理

游戏使用Windows系统内置的中文字体来确保中文显示的准确性。程序会按顺序尝试加载以下字体：微软雅黑（msyh.ttf）、宋体（simsun.ttc）、黑体（simhei.ttf）、楷体（simkai.ttf）、仿宋（simfang.ttf）。如果所有字体都不可用，会使用Pygame默认字体。

### 编码规范

代码遵循以下规范：

- 使用中文注释和变量命名（在合理范围内）
- 遵循PEP 8 Python编码规范
- 采用面向对象的设计模式
- 模块间低耦合、高内聚
- 关键函数和类都有文档字符串

### 扩展指南

想要扩展游戏功能的开发者可以参考以下建议：

**添加新怪物**：在monster.py中创建新的怪物类，定义怪物的属性和行为。怪物可以继承自基类以复用通用逻辑。

**设计新地图**：在map.py中修改地图生成逻辑或直接定义新的地图数据。地图数据使用二维数组表示，每个元素对应一个地图元素类型。

**扩展商店**：在constants.py中修改SHOP_ITEMS字典，添加新的商品配置。定义商品名称、价格、效果和描述。

**调整难度**：修改PLAYER_INITIAL中的初始属性、EXPERIENCE_GROWTH中的经验成长系数，或调整怪物的属性配置来改变游戏难度。

### 打包说明

游戏已预先打包为独立的exe文件，使用PyInstaller生成。打包命令为：「pyinstaller -F -w --icon="魔塔传说_logo.png" -n "魔塔传说" main.py」。其中-F参数表示生成单个文件，-w参数表示隐藏控制台窗口。

如果需要重新打包，请确保已安装PyInstaller，并且运行打包命令时位于正确的目录下。

## 文件清单

安装完成后，程序目录包含以下文件：

- **魔塔传说.exe**：游戏主程序，双击即可运行
- **魔塔传说_logo.png**：游戏图标文件
- **uninstall.bat**：卸载程序，用于彻底删除游戏
- **save_game.dat**：存档文件，记录游戏进度

卸载时，点击开始菜单中的「卸载魔塔传说」选项，或运行uninstall.bat文件即可彻底删除游戏及其相关文件。

## 常见问题

**问：游戏无法启动怎么办？**

请确保系统中已安装Visual C++ Redistributable运行库。如果没有安装，可以从微软官网下载并安装。还要检查游戏文件是否完整，如果文件损坏请重新下载或安装。

**问：中文显示为乱码怎么办？**

游戏会自动检测并使用Windows系统中的中文字体。如果仍然显示乱码，请检查系统是否安装了微软雅黑或宋体等中文字体。

**问：AI模式不工作怎么办？**

请确保在游戏状态下按F键切换AI模式。AI模式只会在游戏进行状态下生效，在菜单界面或战斗界面中可能表现不同。

**问：如何重置游戏进度？**

删除游戏目录下的save_game.dat文件即可重置所有进度。重新启动游戏后会回到初始状态。

**问：游戏运行缓慢怎么办？**

关闭其他正在运行的程序，确保系统有足够的资源运行游戏。如果仍然缓慢，可能是系统配置低于最低要求。

## 版权声明

本游戏由xy12345632@outlook.com与Trace CN中的SOLO Coder开发。

本游戏使用MIT许可证开源，您可以自由使用、学习和修改本项目的源代码。但需要注意的是：

- 禁止将本游戏用于任何商业目的
- 再分发时必须保留原始的版权声明
- 作者对本游戏不承担任何担保责任

游戏中的所有图标、素材均为本项目原创或已获得授权使用。如果您对本游戏的任何部分有版权疑问，请联系开发者处理。

## 致谢

感谢以下人员和项目的支持：

- **Pygame社区**：提供了优秀的Python游戏开发库
- **PyInstaller项目**：提供了便捷的Python程序打包工具
- **测试玩家**：感谢所有参与测试并提供反馈的玩家

## 联系方式

如果您有任何问题、建议或想要贡献代码，请通过以下方式联系开发者：
- **电子邮件**：xy12345632@outlook.com

我们欢迎任何形式的贡献，包括代码改进、文档完善、翻译本地化和问题报告。

---

**祝您在魔塔传说中冒险愉快！**
